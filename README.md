# Neon Database Backup and Restore Scripts

This project provides Python scripts for backing up and restoring a Neon PostgreSQL database, along with an optional script to terminate active connections.

---

## ğŸ“ Project Structure

```bash
â”œâ”€â”€ backup.py               # Script to back up the database
â”œâ”€â”€ restore.py              # Script to restore the latest backup
â”œâ”€â”€ terminate_connections.py # Forcefully terminates all active DB sessions
â”œâ”€â”€ backups/                # Stores .dump files generated by backup.py
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ backup.log          # Log file for backup.py
â”‚   â””â”€â”€ restore.log         # Log file for restore.py
â””â”€â”€ .github/workflows/
    â””â”€â”€ backup.yml          # GitHub Actions workflow to run backup
```

---

## âš™ï¸ Setup Instructions

### 1. Install PostgreSQL Client

On Ubuntu:

```bash
sudo apt update && sudo apt install postgresql-client
```

---

### 2. Set Environment Variables

Set the required environment variables either in your terminal session or as GitHub Actions secrets:

For local usage (add to `.bashrc`, `.zshrc`, or export before running scripts):

```bash
export PGHOST=your_host
export PGDATABASE=your_db_name
export PGUSER=your_username
export PGPASSWORD=your_password
```

---

### 3. Backup

To manually back up your database:

```bash
python3 backup.py
```

- The `.dump` file will be saved to the `backups/` folder.
- Log messages will be written to `logs/backup.log`.

---

### 4. Restore

To manually restore your database from the latest backup:

```bash
python3 restore.py
```

- This will drop the existing database (if no connections) and recreate it.
- Then, it restores from the most recent `.dump` file in the `backups/` directory.
- Log messages will be written to `logs/restore.log`.

---

### 5. GitHub Actions Backup Workflow

Backups can be automated using GitHub Actions:

- **Schedule:** Daily at midnight UTC (`cron: "0 0 * * *"`)
- **Manual Trigger:** Via the GitHub Actions UI

Make sure to configure the following GitHub repository secrets:

- `DB_HOST`
- `DB_NAME`
- `DB_USER`
- `DB_PASSWORD`

---

## ğŸ“ Notes

- `.dump` files are in PostgreSQLâ€™s custom format (`-F c`) to support better compression and flexibility.
- Do not commit `.dump` files to your repository if they contain sensitive data.
- Restore errors may occur if privileges or roles differ between environments.
- The `restore.py` script forcefully ends all active sessions on the target DB to allow clean restores.

---

## ğŸš€ Future Plans

- ğŸ” Secure backups by uploading to S3 when AWS is available
- ğŸ§¹ Add automated cleanup of old backups
- ğŸ“© Email or Slack notifications on backup success/failure

---

## ğŸ‘¤ Author

Crafted with â¤ï¸ by a data engineering enthusiast on a learning journey.  
Contributions, feedback, and ideas are welcome!

KaungMyatKyaw(eggcoder)

